---

title: fastcgi


keywords: fastai
sidebar: home_sidebar

summary: "A fastcgi handler for Python's `socketserver` classes"
description: "A fastcgi handler for Python's `socketserver` classes"
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="http://www.mit.edu/~yandros/doc/specs/fcgi-spec.html">FastCGI</a> is a way for front-end servers to talk to back-end workers in a (somewhat) efficient and (somewhat) simple way. Although it's been around since 1996, it is not very widely appreciated, except in the PHP community, where it is very commonly used.</p>
<p>It can be a great approach for hosting Python scripts, avoiding the overhead of creating a new Python process for every request (as standard CGI would otherwise require) and without requiring large dependencies, complex C projects, or fiddly deployments. <code>fastcgi</code> has no dependencies other than <a href="https://fastcore.fast.ai/">fastcore</a>.</p>
<p>There's no new frameworks or concepts to learn. Just call <code>send</code> to send anything you like back to the client, read the parameters from <code>params</code>, and the input from the client from <code>stdin</code>.</p>
<p><code>fastcgi</code> requires a front-end web server. If you don't already have one set up, we recommend <a href="https://caddyserver.com/">Caddy</a>. To forward all requests to <code>example.com</code> to a <code>fastcgi</code> server listening on port 1234 create a file called <code>Caddyfile</code> with the following contents, and then <code>caddy run</code>:</p>

<pre><code>example.com
reverse_proxy localhost:1234 { transport fastcgi }</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install fastcgi</code> or <code>conda install -c fastai fastcgi</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Probably the only thing you need to use is <a href="/fastcgi/core.html#FcgiHandler"><code>FcgiHandler</code></a>, which is used in much the same way as Python's <a href="https://docs.python.org/3/library/socketserver.html#request-handler-objects">BaseRequestHandler</a>. Here's an example:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TestHandler</span><span class="p">(</span><span class="n">FcgiHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;query:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;content type:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;HTTP_CONTENT_TYPE&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stdin:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Content-type: text/html</span><span class="se">\r\n\r\n</span><span class="s2">&lt;html&gt;foobar&lt;/html&gt;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can run this using any of Python's <code>socketserver</code> classes, e.g to listen on localhost port 1234:</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TCPServer</span><span class="p">((</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span><span class="mi">1234</span><span class="p">),</span> <span class="n">TestHandler</span><span class="p">)</span> <span class="k">as</span> <span class="n">srv</span><span class="p">:</span>
    <span class="n">srv</span><span class="o">.</span><span class="n">handle_request</span><span class="p">()</span>
</pre></div>
<p>See the API docs for <a href="/fastcgi/core.html#FcgiHandler"><code>FcgiHandler</code></a> for an end-to-end example.</p>
<p>You can also create a forking or threading server by using Python's <a href="https://docs.python.org/3/library/socketserver.html#socketserver.ThreadingMixIn">mixins or predefined classes</a>.</p>
<p>In your <code>handle</code> method, you can use the <code>stdin</code>, <code>stdout</code>, and <code>stderr</code> attributes, which each contain a <code>BytesIO</code> stream.</p>

</div>
</div>
</div>
</div>
 

